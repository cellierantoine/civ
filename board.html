<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Civ</title>
        <script src="//cdn.jsdelivr.net/phaser/2.2.2/phaser.min.js"></script>
        <style type="text/css">
            body {
                margin: 0;
            }
        </style>
    </head>
    <body>
        <script src="tile.js"></script>
        <script src="event.js"></script>
        <script src="resource.js"></script>
        <script src="construction.js"></script>
        <script type="text/javascript">
            var TILE_SIZE = 32;
            var TILE_ASPECT = 1;
            var LEVEL_SIZE = 21;
            var TOP_BAR_SIZE = 64;
            var SIDE_BAR_SIZE = 200;


            var game = new Phaser.Game(1072, 736, Phaser.AUTO, '', { preload: preload, create: create, update: update });


            function preload() {
                game.load.image('background', 'assets/background.png');
                game.load.image('grass', 'assets/grass.png');
                game.load.image('water', 'assets/water.png');
                game.load.image('selector', 'assets/selector.png');
                game.load.image('house', 'assets/house.png');
            }


            var ground = [];
            var start;
            var selector;

            var x;
            var y;



            var menu = [[701,108],[777,108],[701,183],[777,183],[701,259],[777,259],[701,334],[777,334],[701,410],[777,410],[701,485],[777,485]];
            var buttons = [];



            function create() {
                //SPRITE
                game.add.sprite(0, 0, 'background');
                mapBeach(ground);

                //SELECTOR
                selector = new Selector();

                //LISTENERS
                document.addEventListener("click", function(event){ click(event, ground, selector); });
                document.addEventListener("mousemove", hover);

                //TIME
                start = game.time.now;

                //BUTTONS
                for(let i = 0; i<menu.length; i++){
                    buttons.push(new Button(menu[i][0], menu[i][1]));
                }


            }

            function update() {
                if(game.time.now > start+5000){
                    //flood(ground);
                    start = game.time.now;
                }

                if(x>692 && x<853 && y>99 && y<561){
                    selector.hoverSideMenu(x, y);
                }
            }

            function click(event, ground, selector){
                console.log(event.pageX+" / "+event.pageY);
                if(event.pageX < 872- SIDE_BAR_SIZE && event.pageY > TOP_BAR_SIZE){
                    selector.moveSelector(event, ground);
                    selector.displaySideMenu(selector.tileSelected.terrainType, selector.tileSelected.building);
                }else if(selector.tileSelected != null && event.pageX > 701 && event.pageX < 769 && event.pageY > 108 && event.pageY < 175){
					buttons[0].act.apply(selector.tileSelected);
                }
            }

            function hover(event){
                x = event.pageX;
                y = event.pageY;
            }


        </script>

    </body>
</html>

