<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Civ</title>
        <script src="//cdn.jsdelivr.net/phaser/2.2.2/phaser.min.js"></script>
        <style type="text/css">
            body {
                margin: 0;
            }
        </style>
    </head>
    <body>
        <script src="tile.js"></script>
        <script src="event.js"></script>
        <script src="resource.js"></script>
        <script src="construction.js"></script>
        <script type="text/javascript">
            var TILE_SIZE = 32;
            var TILE_ASPECT = 1;
            var LEVEL_SIZE = 21;
            var TOP_BAR_SIZE = 64;
            var SIDE_BAR_SIZE = 200;


            var game = new Phaser.Game(1072, 736, Phaser.AUTO, '', { preload: preload, create: create, update: update });


            function preload() {
                game.load.image('background', 'assets/background.png');
                game.load.image('grass', 'assets/grass.png');
                game.load.image('water', 'assets/water.png');
                game.load.image('selector', 'assets/selector.png');
                game.load.image('house', 'assets/house.png');
            }


            var ground = [];
            var start;
            var selector;

            var x;
            var y;

            var text;
            var style;

            var menu = [[701,108],[777,108],[701,183],[777,183],[701,259],[777,259],[701,334],[777,334],[701,410],[777,410],[701,485],[777,485]];



            function create() {
                //SPRITE
                game.add.sprite(0, 0, 'background');
                mapBeach(ground);

                //SELECTOR
                selector = new Selector();

                document.addEventListener("click", function(event){ click(event, ground, selector); });
                document.addEventListener("mousemove", hover);

                //start time
                start = game.time.now;

                let sprite = game.add.sprite(701, 108, 'house');
                console.log(sprite.width +" // "+sprite.height)
                sprite.width = sprite.width*2;
                sprite.height = sprite.height*2;
                sprite.smoothed = false;

                style = { font: "65px Arial", fill: "#ff0044", align: "center" };
                text = game.add.text(880, 200, 'coucou', style);


            }

            function update() {
                if(game.time.now > start+5000){
                    //flood(ground);
                    start = game.time.now;
                }

                if(x > 701 && x < 701+67 && y > 108 && y < 108+67){
                    text.destroy();
                    text = game.add.text(880, 200, 'MAISON', style);
                }


            }

            function click(event, ground, selector){
                if(event.clientX < 872- SIDE_BAR_SIZE && event.clientY > TOP_BAR_SIZE){
                    selector.moveSelector(event, ground);
                }else if(selector.tileSelected != null && event.clientX > 701 && event.clientX < 701+67 && event.clientY > 108 && event.clientY < 108+67){
                    selector.tileSelected.buildHouse();
                }
            }

            function hover(event){
                x = event.clientX;
                y = event.clientY;
            }


        </script>

    </body>
</html>